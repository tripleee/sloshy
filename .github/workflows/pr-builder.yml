name: PR Builder

on:
  workflow_dispatch:
    inputs:
      chatroom-url:
        description: >
          URL of the chatroom you want to add to Sloshy's configuration
        required: true
      user-url:
        descrioption: >
          Your Stack Exchange user profile URL
        required: true

jobs:
  pr-generator:
    runs-on: ubuntu-latest

    steps:
    - name: Show GitHub context
      env:
        GITHUB_CONTEXT: ${{ toJson(github) }}
      run: echo "$GITHUB_CONTEXT"
    - name: Check out sources
      uses: actions/checkout@v4
    - name: Create branch and commit for PR
      env:
        branch: branch-${{ github.run_id }}-${{ github.run_attempt }}
      run:
        git checkout -b "$branch"
        echo poo >sloshy.yaml
        git add sloshy.yaml
        echo "Request by ${{github.events.inputs.user-url}}" >>commit
        git commit -F commit
    - name: Create PR
      run:
        gh pr create -B master --fill
